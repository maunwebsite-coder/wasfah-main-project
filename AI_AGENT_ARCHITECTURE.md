# معمارية نظام المساعد الذكي

## نظرة عامة على النظام

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   المستخدم      │    │   واجهة الويب   │    │   API الخارجي   │
│   (User)        │◄──►│   (Web UI)      │◄──►│   (External)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   المتحكم       │
                    │   (Controller)  │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   الخدمة        │
                    │   (Service)     │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   التخزين المؤقت│
                    │   (Cache)       │
                    └─────────────────┘
```

## طبقات النظام

### 1. طبقة العرض (Presentation Layer)

#### الملفات:
- `resources/views/ai-agent/index.blade.php` - واجهة المحادثة
- `resources/views/layouts/app.blade.php` - شريط التنقل
- `resources/js/ai-agent.js` - JavaScript للتفاعل

#### الميزات:
- واجهة محادثة تفاعلية
- مؤشرات بصرية للحالة
- نظام تقييم بالنجوم
- تصميم متجاوب

### 2. طبقة التحكم (Controller Layer)

#### الملفات:
- `app/Http/Controllers/AIAgentController.php`

#### الوظائف:
- إدارة طلبات المستخدمين
- التحقق من صحة البيانات
- إدارة التقييمات
- التحقق من حالة الخدمة

### 3. طبقة الخدمة (Service Layer)

#### الملفات:
- `app/Services/AIAgentService.php`

#### الوظائف:
- إدارة الاتصال مع API الخارجي
- تخزين المحادثات في الكاش
- معالجة الأخطاء وإعادة المحاولة
- نظام التقييم

### 4. طبقة التكوين (Configuration Layer)

#### الملفات:
- `config/ai_agent.php`
- متغيرات البيئة

#### الإعدادات:
- إعدادات API
- إعدادات التخزين المؤقت
- إعدادات الأمان
- إعدادات التحليلات

## تدفق البيانات

### 1. إرسال رسالة

```
المستخدم → JavaScript → Controller → Service → API الخارجي
    ↓
الكاش ← Service ← API الخارجي ← Service ← Controller ← JavaScript
```

### 2. التحقق من الحالة

```
JavaScript → Controller → Service → API الخارجي
    ↓
JavaScript ← Controller ← Service ← API الخارجي
```

### 3. إدارة التقييم

```
المستخدم → JavaScript → Controller → Service → API الخارجي
```

## إدارة الأخطاء

### 1. أخطاء الاتصال
- إعادة المحاولة التلقائية
- رسائل خطأ واضحة
- تسجيل الأخطاء

### 2. أخطاء التحقق
- التحقق من صحة البيانات
- رسائل خطأ باللغة العربية
- إعادة توجيه مناسبة

### 3. أخطاء النظام
- تسجيل مفصل
- مراقبة الأداء
- إشعارات الأخطاء

## الأمان

### 1. حماية CSRF
- رموز CSRF في جميع الطلبات
- التحقق من صحة الرموز

### 2. تحديد المعدل
- 10 طلبات في الدقيقة
- 100 طلب في الساعة
- حماية من الإساءة

### 3. فلترة المحتوى
- فلترة الكلمات المحظورة
- التحقق من صحة البيانات
- حماية من الهجمات

## التخزين المؤقت

### 1. تخزين المحادثات
- مدة التخزين: ساعة واحدة
- الحد الأقصى: 10 محادثات
- تنظيف تلقائي

### 2. تخزين الحالة
- مدة التخزين: 5 دقائق
- تحديث دوري
- مراقبة الأداء

## المراقبة والتحليلات

### 1. سجلات النظام
- تسجيل جميع الطلبات
- تتبع الأخطاء
- مراقبة الأداء

### 2. التحليلات
- تتبع استخدام المساعد
- إحصائيات التقييمات
- مراقبة جودة الردود

## التوسع المستقبلي

### 1. ميزات مخططة
- دعم الملفات والصور
- ذاكرة محادثة أطول
- تكامل مع قاعدة البيانات
- إشعارات فورية

### 2. تحسينات الأداء
- ضغط البيانات
- تحسين التخزين المؤقت
- تحسين واجهة المستخدم
- تحسين الأمان

## أفضل الممارسات

### 1. التطوير
- اتباع معايير Laravel
- كتابة كود نظيف
- توثيق شامل
- اختبارات شاملة

### 2. النشر
- نسخ احتياطية
- اختبار في بيئة التطوير
- مراقبة الأداء
- تحديثات دورية

### 3. الصيانة
- تنظيف دوري
- مراقبة السجلات
- تحديثات أمنية
- تحسينات الأداء

## استكشاف الأخطاء

### 1. مشاكل شائعة
- فشل الاتصال مع API
- مشاكل JavaScript
- مشاكل التخزين المؤقت
- مشاكل الأمان

### 2. أدوات التشخيص
- سجلات النظام
- أدوات المطور
- مراقبة الأداء
- اختبارات الوحدة

### 3. حلول المشاكل
- التحقق من الإعدادات
- مسح الكاش
- إعادة تشغيل الخدمات
- تحديث النظام

---

هذا المخطط يوضح البنية التقنية للنظام ويساعد في فهم كيفية عمل المكونات المختلفة معاً.
